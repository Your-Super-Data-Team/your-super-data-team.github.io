<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <title>Your Super Ad Name Helper</title>
    <style>
        .output {
            text-indent:1em;
            color:#ff8c00;
            overflow-wrap: break-word;
        }
        .output-code {
            margin-left:1em;
        }
        .output-row {
            margin-bottom:1em;
        }
    </style>
  </head>
  <body>
    <div class="container">
        <div class="row page-header" style="margin-top:2em;">
            <div class="col-sm">
                <h1>Your Super Ad Naming Helper</h1>
            </div>
        </div>
        <div class="row" style="height:2em;"></div> <!-- spacer -->
        <div class="row output-row"> <!-- campaign name -->
            <div class="col-md">
                <h3>Campaign Name</h3>
                <h2 id="output" class="output">Output example</h2>
                <div class="form-group output-code row">
                    <!-- <input type="text" value="" name="" id="output_code"/> -->
                    <label for="output_code" class="col-sm-2 col-form-label">For Copy &amp; Paste</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" id="output_code" rows="1"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row output-row" id="row_adgroup" hidden> <!-- ad group name -->
            <div class="col-md">
                <h3>Ad Group</h3>
                <div class="alert alert-info output-code" role="alert">
                    This is a short format for new ad groups. You don't need to rename old ad groups / ad sets just yet.
                </div>
                <h2 id="output_adgroup" class="output"> Adgroup </h2>
                <div class="form-group output-code row">
                    <label for="output_code" class="col-sm-2 col-form-label">For Copy &amp; Paste</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" id="output_code_adgroup" rows="1"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row output-row" id="row_utm"> <!-- link with utm tags -->
            <div class="col-md">
                <h3>Link with UTM Tags</h3>
                <div class="form-group output-code row">
                    <label for="output_code" class="col-sm-2 col-form-label">For Copy &amp; Paste</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" id="output_code_utm" rows="2"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="height:2em;"></div>
        <div class="row">
            <form id="categories">
            <div class="row">
                <div class="col-sm">
                    <div class="mb-3">
                        <label for="channel" class="form-label">Channel</label>
                        <select class="form-select" aria-label="Channel Selector" name="Ad channel" id="channel">
                            <option value="PaidSocial">Paid Social</option>
                            <option value="PaidSearch">Paid Search</option>
                            <option value="Video">Video</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Affiliate">Affiliate</option>
                            <option value="Display">Display</option>
                            <option value="Influencer">Influencer</option>
                        </select>
                    </div>
                    <!-- <button type="submit" class="btn btn&#45;primary">Submit</button> -->
                </div>
                <div class="col-sm">
                    <div class="mb-3">
                        <label for="region" class="form-label">Region</label>
                        <select class="form-select" aria-label="Channel Selector" id="region">
                            <option value="US">United States</option>
                            <option value="EU">European Union</option>
                            <option value="DE">Germany</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                    <div class="mb-3">
                        <label for="platform" class="form-label">Platform</label>
                        <select class="form-select" aria-label="Channel Selector" id="platform">
                            <option value="FB">Facebook</option>
                            <option value="GOOGL">Google</option>
                            <option value="BNG">Bing</option>
                            <option value="YT">YouTube</option>
                            <option value="PIN">Pinterest</option>
                            <option value="Criteo">Criteo</option>
                            <option value="TT">TikTok</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm">
                    <div class="mb-3">
                        <label for="tactic" class="form-label">Tactic</label>
                        <select class="form-select" aria-label="Channel Selector" id="tactic">
                            <option value="PROS">Prospecting</option>
                            <option value="RET">Retargeting</option>
                            <option value="Mixed">Mixed</option>
                            <option value="AP">After Purchase</option>
                            <option value="NB">Non-Branded</option>
                            <option value="B">Branded</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                    <div class="mb-3">
                        <label for="productCategory" class="form-label">Product Category</label>
                        <input type="text" class="form-control" id="productCategory">
                        <small class="form-text text-muted">Multiple words will be combined using CamelCase style for the names and dash-lower for UTM tags. :)</small>
                    </div>
                </div>
                <div class="col-sm">
                    <div class="mb-3">
                        <label for="audience" class="form-label">Audience</label>
                        <input type="text" class="form-control" id="audience">
                        <small class="form-text text-muted">Multiple words will be combined using CamelCase style for the names and dash-lower for UTM tags. :)</small>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                    <div class="mb-3">
                        <label for="landingPage" class="form-label">Landing Page</label>
                        <input type="text" class="form-control" id="landingPage" value="https://yoursuper.com">
                        <small class="form-text text-muted">Used when building the link with UTM tags</small>
                    </div>
                </div>
                <div class="col-sm">
                    <div class="mb-3">
                        <label for="utmContent" class="form-label">UTM Content Tag (optional)</label>
                        <input type="text" class="form-control" id="utmContent">
                        <small class="form-text text-muted">You can use this to identify the creative in the ad.</small>
                    </div>
                </div>
            </div>
            </form>
        </div>
        <div style="height:5em;"></div>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <script src="js/lodash.min.js"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
    -->

    <script>
        const utm_source_map = {'FB': 'facebook', 'GOOGL': 'google', 'BNG': 'bing', 'YT': 'youtube', 'PIN': 'pinterest', 'Criteo': 'criteo', 'TT': 'tiktok'}
        const formElement = document.querySelector('#categories');
        const output = document.querySelector('#output');
        const output_code = document.querySelector('#output_code');

        const row_adgroup = document.querySelector('#row_adgroup');
        const output_adgroup = document.querySelector('#output_adgroup');
        const output_code_adgroup = document.querySelector('#output_code_adgroup');

        const output_code_utm = document.querySelector('#output_code_utm');

        formElement.addEventListener('change', updateValue);

        function clean(given_string) {
            return _.upperFirst(_.camelCase(given_string).replace(/_|\s/gi, ""));
        }
        function dash_lower(given_string) {
            return _.snakeCase(given_string).replace(/_/gi, "-")
        }
        function maybe_add_trailing_slash(url){
            var lastChar = url.substr(-4); // Selects the last character
            if (lastChar == '.com') {      // If the last character is not a slash
               url = url + '/';            // Append a slash to it.
            }
            return url;
        }
        function adgroup_name( product_category_raw, audience_raw ) {
            var name_adgroup = ``;
            if (product_category_raw && audience_raw) {
                name_adgroup = name_adgroup + clean(product_category_raw) + "_" + clean( audience_raw )
            } else if (product_category_raw) {
                name_adgroup = name_adgroup + clean(product_category_raw)
            } else if ( audience_raw ) {
                name_adgroup = name_adgroup + "_" + clean( audience_raw )
            }
            return name_adgroup;
        }
        function maybe_term(channel_raw, audience_raw) {
            // return term value if this isn't paid search
            if (channel_raw == 'PaidSearch' || audience_raw.length == 0) {
                return '';
            } else {
                return `&utm_term=${dash_lower(audience_raw)}`;
            }
        }
        function maybe_content(utm_content_raw){
            if (utm_content_raw.length == 0) {
                return '';
            } else {
                return `&utm_content=${dash_lower(utm_content_raw)}`;
            }
        }

        function updateValue(e) {
            // Values
            let channel_raw = formElement.elements['channel'].value;
            let region_raw = formElement.elements['region'].value;
            let platform_raw = formElement.elements['platform'].value;
            let tactic_raw = formElement.elements['tactic'].value;
            let product_category_raw = formElement.elements['productCategory'].value;
            let audience_raw = formElement.elements['audience'].value;
            let landing_page_raw = formElement.elements['landingPage'].value;
            let utm_content_raw = formElement.elements['utmContent'].value;

            let campaign_name_base = `${channel_raw}_${region_raw}_${platform_raw}_${tactic_raw}`;
            let name_adgroup = adgroup_name( product_category_raw, audience_raw );

            if (name_adgroup.length > 0) {
                row_adgroup.hidden = false;
                var campaign_name = `${campaign_name_base}_${name_adgroup}`
            } else if (name_adgroup.length == 0) {
                row_adgroup.hidden = true;
                var campaign_name = `${campaign_name_base}`
            }

            output.textContent = campaign_name;
            output_code.value = campaign_name;
            output_adgroup.textContent = name_adgroup;
            output_code_adgroup.value = name_adgroup;

            // Build UTM
            link_utm = `${maybe_add_trailing_slash(landing_page_raw)}?utm_source=${dash_lower(utm_source_map[platform_raw])}&utm_medium=${dash_lower(channel_raw)}&utm_campaign=${campaign_name}${maybe_term(channel_raw, audience_raw)}${maybe_content(utm_content_raw)}`;
            output_code_utm.value = link_utm;
        }

        updateValue()
    </script>
  </body>
</html>
